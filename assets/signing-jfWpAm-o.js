import{i as M,b as B,a as ne,c as se,e as T,r as ae,p as j,d as k}from"./index-BRF7Ggi6.js";import{V as ie,W as ce,X as oe,Y as y,Z as N,$ as l,z as b,k as h,a0 as A,a1 as _,a2 as ue,a3 as I,a4 as z,q as de,a5 as pe,a6 as L,a7 as ye,O as f,a8 as V,a9 as fe,G as H,F}from"./index-468SvDLd.js";function g(e,t={}){const{as:r=typeof e=="string"?"Hex":"Bytes"}=t,n=ie(ce(e));return r==="Bytes"?n:oe(n)}class le extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const r=super.get(t);return super.has(t)&&r!==void 0&&(this.delete(t),super.set(t,r)),r}set(t,r){if(super.set(t,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const he={checksum:new le(8192)},$=he.checksum,me=/^0x[a-fA-F0-9]{40}$/;function S(e,t={}){const{strict:r=!0}=t;if(!me.test(e))throw new P({address:e,cause:new R});if(r){if(e.toLowerCase()===e)return;if(ge(e)!==e)throw new P({address:e,cause:new we})}}function ge(e){if($.has(e))return $.get(e);S(e,{strict:!1});const t=e.substring(2).toLowerCase(),r=g(N(t),{as:"Bytes"}),n=t.split("");for(let a=0;a<40;a+=2)r[a>>1]>>4>=8&&n[a]&&(n[a]=n[a].toUpperCase()),(r[a>>1]&15)>=8&&n[a+1]&&(n[a+1]=n[a+1].toUpperCase());const s=`0x${n.join("")}`;return $.set(e,s),s}function be(e,t={}){const{strict:r=!0}=t??{};try{return S(e,{strict:r}),!0}catch{return!1}}class P extends y{constructor({address:t,cause:r}){super(`Address "${t}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class R extends y{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class we extends y{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function xe({checksumAddress:e,parameters:t,values:r}){const n=[];for(let s=0;s<t.length;s++)n.push(D({checksumAddress:e,parameter:t[s],value:r[s]}));return n}function D({checksumAddress:e=!1,parameter:t,value:r}){const n=t,s=ve(n.type);if(s){const[a,i]=s;return Ae(r,{checksumAddress:e,length:a,parameter:{...n,type:i}})}if(n.type==="tuple")return Pe(r,{checksumAddress:e,parameter:n});if(n.type==="address")return Ee(r,{checksum:e});if(n.type==="bool")return Te(r);if(n.type.startsWith("uint")||n.type.startsWith("int")){const a=n.type.startsWith("int"),[,,i="256"]=M.exec(n.type)??[];return Se(r,{signed:a,size:Number(i)})}if(n.type.startsWith("bytes"))return Ie(r,{type:n.type});if(n.type==="string")return $e(r);throw new q(n.type)}function O(e){let t=0;for(let a=0;a<e.length;a++){const{dynamic:i,encoded:c}=e[a];i?t+=32:t+=l(c)}const r=[],n=[];let s=0;for(let a=0;a<e.length;a++){const{dynamic:i,encoded:c}=e[a];i?(r.push(b(t+s,{size:32})),n.push(c),s+=l(c)):r.push(c)}return h(...r,...n)}function Ee(e,t){const{checksum:r=!1}=t;return S(e,{strict:r}),{dynamic:!1,encoded:A(e.toLowerCase())}}function Ae(e,t){const{checksumAddress:r,length:n,parameter:s}=t,a=n===null;if(!Array.isArray(e))throw new ze(e);if(!a&&e.length!==n)throw new Me({expectedLength:n,givenLength:e.length,type:`${s.type}[${n}]`});let i=!1;const c=[];for(let o=0;o<e.length;o++){const u=D({checksumAddress:r,parameter:s,value:e[o]});u.dynamic&&(i=!0),c.push(u)}if(a||i){const o=O(c);if(a){const u=b(c.length,{size:32});return{dynamic:!0,encoded:c.length>0?h(u,o):u}}if(i)return{dynamic:!0,encoded:o}}return{dynamic:!1,encoded:h(...c.map(({encoded:o})=>o))}}function Ie(e,{type:t}){const[,r]=t.split("bytes"),n=l(e);if(!r){let s=e;return n%32!==0&&(s=I(s,Math.ceil((e.length-2)/2/32)*32)),{dynamic:!0,encoded:h(A(b(n,{size:32})),s)}}if(n!==Number.parseInt(r))throw new W({expectedSize:Number.parseInt(r),value:e});return{dynamic:!1,encoded:I(e)}}function Te(e){if(typeof e!="boolean")throw new y(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:A(_(e))}}function Se(e,{signed:t,size:r}){if(typeof r=="number"){const n=2n**(BigInt(r)-(t?1n:0n))-1n,s=t?-n-1n:0n;if(e>n||e<s)throw new ue({max:n.toString(),min:s.toString(),signed:t,size:r/8,value:e.toString()})}return{dynamic:!1,encoded:b(e,{size:32,signed:t})}}function $e(e){const t=z(e),r=Math.ceil(l(t)/32),n=[];for(let s=0;s<r;s++)n.push(I(de(t,s*32,(s+1)*32)));return{dynamic:!0,encoded:h(I(b(l(t),{size:32})),...n)}}function Pe(e,t){const{checksumAddress:r,parameter:n}=t;let s=!1;const a=[];for(let i=0;i<n.components.length;i++){const c=n.components[i],o=Array.isArray(e)?i:c.name,u=D({checksumAddress:r,parameter:c,value:e[o]});a.push(u),u.dynamic&&(s=!0)}return{dynamic:s,encoded:s?O(a):h(...a.map(({encoded:i})=>i))}}function ve(e){const t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}function U(e,t,r){const{checksumAddress:n=!1}={};if(e.length!==t.length)throw new G({expectedLength:e.length,givenLength:t.length});const s=xe({checksumAddress:n,parameters:e,values:t}),a=O(s);return a.length===0?"0x":a}function v(e,t){if(e.length!==t.length)throw new G({expectedLength:e.length,givenLength:t.length});const r=[];for(let n=0;n<e.length;n++){const s=e[n],a=t[n];r.push(v.encode(s,a))}return h(...r)}(function(e){function t(r,n,s=!1){if(r==="address"){const o=n;return S(o),A(o.toLowerCase(),s?32:0)}if(r==="string")return z(n);if(r==="bytes")return n;if(r==="bool")return A(_(n),s?32:1);const a=r.match(M);if(a){const[o,u,p="256"]=a,d=Number.parseInt(p)/8;return b(n,{size:s?32:d,signed:u==="int"})}const i=r.match(B);if(i){const[o,u]=i;if(Number.parseInt(u)!==(n.length-2)/2)throw new W({expectedSize:Number.parseInt(u),value:n});return I(n,s?32:0)}const c=r.match(ne);if(c&&Array.isArray(n)){const[o,u]=c,p=[];for(let d=0;d<n.length;d++)p.push(t(u,n[d],!0));return p.length===0?"0x":h(...p)}throw new q(r)}e.encode=t})(v||(v={}));class Me extends y{constructor({expectedLength:t,givenLength:r,type:n}){super(`Array length mismatch for type \`${n}\`. Expected: \`${t}\`. Given: \`${r}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}}let W=class extends y{constructor({expectedSize:t,value:r}){super(`Size of bytes "${r}" (bytes${l(r)}) does not match expected size (bytes${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}};class G extends y{constructor({expectedLength:t,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${t}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class ze extends y{constructor(t){super(`Value \`${t}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}}class q extends y{constructor(t){super(`Type \`${t}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}function De(e){const{domain:t,message:r,primaryType:n,types:s}=e,a=(i,c)=>{for(const o of i){const{name:u,type:p}=o,d=c[u],w=p.match(M);if(w&&(typeof d=="number"||typeof d=="bigint")){const[,m,C]=w;b(d,{signed:m==="int",size:Number.parseInt(C??"")/8})}if(p==="address"&&typeof d=="string"&&!be(d))throw new P({address:d,cause:new R});const E=p.match(B);if(E){const[,m]=E;if(m&&l(d)!==Number.parseInt(m))throw new je({expectedSize:Number.parseInt(m),givenSize:l(d)})}const x=s[p];x&&(He(p),a(x,d))}};if(s.EIP712Domain&&t){if(typeof t!="object")throw new ke({domain:t});a(s.EIP712Domain,t)}if(n!=="EIP712Domain")if(s[n])a(s[n],r);else throw new Ne({primaryType:n,types:s})}function Oe(e){const{primaryType:t,types:r}=e;let n="";const s=Y({primaryType:t,types:r});s.delete(t);const a=[t,...Array.from(s).sort()];for(const i of a)n+=`${i}(${(r[i]??[]).map(({name:c,type:o})=>`${o} ${c}`).join(",")})`;return n}function J(e){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},typeof(e==null?void 0:e.chainId)=="number"&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function Ce(e){const{domain:t,types:r}=e;return Le({data:t,primaryType:"EIP712Domain",types:{...r,EIP712Domain:(r==null?void 0:r.EIP712Domain)||J(t)}})}function Le(e){const{data:t,primaryType:r,types:n}=e,s=K({data:t,primaryType:r,types:n});return g(s)}function Be(e){try{return De(e),!0}catch{return!1}}class je extends y{constructor({expectedSize:t,givenSize:r}){super(`Expected bytes${t}, got bytes${r}.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.BytesSizeMismatchError"})}}class ke extends y{constructor({domain:t}){super(`Invalid domain "${pe(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidDomainError"})}}class Ne extends y{constructor({primaryType:t,types:r}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(r))}\`.`,{metaMessages:["Check that the primary type is a key in `types`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidPrimaryTypeError"})}}class _e extends y{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidStructTypeError"})}}function K(e){const{data:t,primaryType:r,types:n}=e,s=[{type:"bytes32"}],a=[Ve({primaryType:r,types:n})];for(const i of n[r]??[]){const[c,o]=X({types:n,name:i.name,type:i.type,value:t[i.name]});s.push(c),a.push(o)}return U(s,a)}function Ve(e){const{primaryType:t,types:r}=e,n=z(Oe({primaryType:t,types:r}));return g(n)}function X(e){let{types:t,name:r,type:n,value:s}=e;if(t[n]!==void 0)return[{type:"bytes32"},g(K({data:s,primaryType:n,types:t}))];if(n==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},g(s,{as:"Hex"})];if(n==="string")return[{type:"bytes32"},g(N(s),{as:"Hex"})];if(n.lastIndexOf("]")===n.length-1){const a=n.slice(0,n.lastIndexOf("[")),i=s.map(c=>X({name:r,type:a,types:t,value:c}));return[{type:"bytes32"},g(U(i.map(([c])=>c),i.map(([,c])=>c)))]}return[{type:n},s]}function Y(e,t=new Set){const{primaryType:r,types:n}=e,s=r.match(/^\w*/u),a=s==null?void 0:s[0];if(t.has(a)||n[a]===void 0)return t;t.add(a);for(const i of n[a])Y({primaryType:i.type,types:n},t);return t}function He(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new _e({type:e})}const Fe="0x6492649264926492649264926492649264926492649264926492649264926492";function Z({address:e,data:t,signature:r}){return se([T([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,t,r]),Fe])}const Re="0x1626ba7e",Ue=[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],We=[{type:"bytes4"}];async function Ge(e){return ae({contract:e.contract,method:[Re,Ue,We],params:[e.hash,e.signature]})}const qe="0x1626ba7e";async function Q({hash:e,signature:t,contract:r}){try{return await Ge({contract:r,hash:e,signature:t})===qe}catch(n){return console.error("Error verifying EIP-1271 signature",n),!1}}const Je=`Ethereum Signed Message:
`;function Ke(e,t){const r=typeof e=="string"?L(e):e.raw instanceof Uint8Array?e.raw:ye(e.raw),n=L(`${Je}${r.length}`);return f(V(n,r),t)}function Xe(e){const{domain:t={},message:r,primaryType:n}=e,s={EIP712Domain:J(t),...e.types};Be({domain:t,message:r,primaryType:n,types:s});const a=["0x1901"];if(t&&a.push(Ce({domain:t,types:s})),n!=="EIP712Domain"){const i=(()=>{const c=ee({data:r,primaryType:n,types:s});return f(c)})();a.push(i)}return f(V(...a.map(i=>fe(i))))}function ee({data:e,primaryType:t,types:r}){const n=[{type:"bytes32"}],s=[Ye({primaryType:t,types:r})];if(!r[t])throw new Error("Invalid types");for(const a of r[t]){const[i,c]=re({name:a.name,type:a.type,types:r,value:e[a.name]});n.push(i),s.push(c)}return T(n,s)}function Ye({primaryType:e,types:t}){const r=H(Ze({primaryType:e,types:t}));return f(r)}function Ze({primaryType:e,types:t}){let r="";const n=te({primaryType:e,types:t});n.delete(e);const s=[e,...Array.from(n).sort()];for(const a of s){if(!t[a])throw new Error("Invalid types");r+=`${a}(${t[a].map(({name:i,type:c})=>`${c} ${i}`).join(",")})`}return r}function te({primaryType:e,types:t},r=new Set){const n=e.match(/^\w*/u),s=n==null?void 0:n[0];if(r.has(s)||t[s]===void 0)return r;r.add(s);for(const a of t[s])te({primaryType:a.type,types:t},r);return r}function re({types:e,name:t,type:r,value:n}){if(e[r]!==void 0)return[{type:"bytes32"},f(ee({data:n,primaryType:r,types:e}))];if(r==="bytes")return n=`0x${(n.length%2?"0":"")+n.slice(2)}`,[{type:"bytes32"},f(n)];if(r==="string")return[{type:"bytes32"},f(H(n))];if(r.lastIndexOf("]")===r.length-1){const s=r.slice(0,r.lastIndexOf("[")),a=n.map(i=>re({name:t,type:s,types:e,value:i}));return[{type:"bytes32"},f(T(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:r},n]}async function rt({accountContract:e,factoryContract:t,options:r,message:n}){var o,u;const s=Ke(n);let a;const i=T([{type:"bytes32"}],[s]);if(a=await r.personalAccount.signTypedData({domain:{chainId:r.chain.id,name:"Account",verifyingContract:e.address,version:"1"},message:{message:i},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]}}),await F(e)){if(await Q({contract:e,hash:s,signature:a}))return a;throw new Error("Failed to verify signature")}else{const p=j({accountSalt:(o=r.overrides)==null?void 0:o.accountSalt,adminAddress:r.personalAccount.address,createAccountOverride:(u=r.overrides)==null?void 0:u.createAccount,factoryContract:t});if(!p)throw new Error("Create account override not provided");const d=await k(p);return Z({address:t.address,data:d,signature:a})}}async function nt({accountContract:e,factoryContract:t,options:r,typedData:n}){var u,p,d,w,E;if(((p=(u=n.domain)==null?void 0:u.verifyingContract)==null?void 0:p.toLowerCase())===((d=e.address)==null?void 0:d.toLowerCase()))return r.personalAccount.signTypedData(n);const a=Xe(n);let i;const c=T([{type:"bytes32"}],[a]);if(i=await r.personalAccount.signTypedData({domain:{chainId:r.chain.id,name:"Account",verifyingContract:e.address,version:"1"},message:{message:c},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]}}),await F(e)){if(await Q({contract:e,hash:a,signature:i}))return i;throw new Error("Failed to verify signature")}else{const x=j({accountSalt:(w=r.overrides)==null?void 0:w.accountSalt,adminAddress:r.personalAccount.address,createAccountOverride:(E=r.overrides)==null?void 0:E.createAccount,factoryContract:t});if(!x)throw new Error("Create account override not provided");const m=await k(x);return Z({address:t.address,data:m,signature:i})}}export{rt as smartAccountSignMessage,nt as smartAccountSignTypedData};
